{"ast":null,"code":"var _jsxFileName = \"/Users/jake/workspace/token-builder/src/Components/Dashboard.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { ethers } from 'ethers';\nimport './dashboard.css';\nimport { Link } from 'react-router-dom';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport abi from './abi';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst rxAddress = /^0x[a-fA-F0-9]{40}$/;\n\nconst Dashboard = props => {\n  _s();\n\n  const [tokenData, setTokenData] = useState({\n    accountAddress: '',\n    balance: '',\n    name: '',\n    symbol: '',\n    decimals: ''\n  });\n  const [transferRecipient, setTransferRecipient] = useState('');\n  const [transferAmount, setTransferAmount] = useState('');\n  const [allowanceSpender, setAllowanceSpender] = useState('');\n  const [allowanceAmount, setAllowanceAmount] = useState('');\n  const [allowanceAvailable, setAllowanceAvailable] = useState('');\n  const [validAllowance, setValidAllowance] = useState(false);\n  const [claimOwner, setClaimOwner] = useState('');\n  const [claimAmount, setClaimAmount] = useState('');\n  const [sendAllowance, setSendAllowance] = useState(false);\n  const [sendAddress, setSendAddress] = useState('');\n  useEffect(async () => {\n    const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n    await provider.send(\"eth_requestAccounts\", []);\n    const signer = provider.getSigner();\n    const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n    const pUser = signer.getAddress();\n    const pName = erc20.name();\n    const pSymbol = erc20.symbol();\n    const pDecimals = erc20.decimals();\n    const [user, name, symbol, decimals] = await Promise.all([pUser, pName, pSymbol, pDecimals]);\n    const balance = await erc20.balanceOf(user);\n    setTokenData({\n      accountAddress: user,\n      balance: balance.toString(),\n      name: name,\n      symbol: symbol,\n      decimals: decimals\n    });\n    const filter = erc20.filters.Transfer(signer.address);\n    erc20.on(filter, async (from, to, amount, event) => {\n      console.log(JSON.stringify(tokenData));\n      const bal = await erc20.balanceOf(await signer.address);\n      setTokenData({ ...tokenData,\n        balance: bal.toString()\n      });\n    });\n    provider.provider.on(\"accountsChanged\", async () => {\n      const signer = provider.getSigner();\n      const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n      const pUser = signer.getAddress();\n      const pName = erc20.name();\n      const pSymbol = erc20.symbol();\n      const pDecimals = erc20.decimals();\n      const [user, name, symbol, decimals] = await Promise.all([pUser, pName, pSymbol, pDecimals]);\n      const balance = await erc20.balanceOf(user);\n      setTokenData({\n        accountAddress: user,\n        balance: balance.toString(),\n        name: name,\n        symbol: symbol,\n        decimals: decimals\n      });\n    });\n    return () => {\n      erc20.removeAllListeners();\n    };\n  }, []);\n  useEffect(async () => {\n    if (rxAddress.test(claimOwner)) {\n      const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n      await provider.send(\"eth_requestAccounts\", []);\n      const signer = provider.getSigner();\n      const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n      const decimals = await erc20.decimals();\n\n      try {\n        const _allowance = await erc20.allowance(claimOwner, await signer.getAddress());\n\n        setAllowanceAvailable(formatBalance(_allowance.toString(), decimals));\n        setValidAllowance(true);\n      } catch (err) {\n        console.error(err);\n      }\n    } else setValidAllowance(false);\n  }, [claimOwner]);\n\n  const transferTokens = async (recipient, amount) => {\n    try {\n      const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n      await provider.send(\"eth_requestAccounts\", []);\n      const signer = provider.getSigner();\n      const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n      const decimals = await erc20.decimals();\n      await erc20.transfer(recipient, parseAmount(amount, decimals));\n    } catch (e) {\n      console.error(e);\n      alert('Error: Transfer failed.');\n    }\n  };\n\n  const setTokenAllowance = async (recipient, amount) => {\n    try {\n      const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n      await provider.send(\"eth_requestAccounts\", []);\n      const signer = provider.getSigner();\n      const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n      const sender = await signer.getAddress();\n      const balance = await erc20.balanceOf(sender);\n      const decimals = await erc20.decimals();\n\n      if (balance.gte(parseAmount(amount, decimals))) {\n        await erc20.approve(recipient, parseAmount(amount, decimals));\n      } else alert(\"Error: Insufficient balance.\");\n    } catch (e) {\n      console.error(e);\n      alert('Error: Allowance failed.');\n    }\n  };\n\n  const transferAllowance = async (owner, recipient, amount) => {\n    try {\n      const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n      await provider.send(\"eth_requestAccounts\", []);\n      const signer = provider.getSigner();\n      const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n      const balance = await erc20.balanceOf(owner);\n      const decimals = await erc20.decimals();\n\n      if (balance >= formatBalance(amount, decimals)) {\n        await erc20.transferFrom(owner, recipient, parseAmount(amount, decimals));\n      }\n\n      const _allowance = await erc20.allowance(owner, recipient);\n\n      setAllowanceAvailable(formatBalance(_allowance.toString(), decimals));\n    } catch (e) {\n      console.error(e);\n      alert('Error: Transfer failed.');\n    }\n  };\n\n  const formatBalance = (balance, dec) => {\n    if (dec === 0) return balance;\n    let bal = balance;\n\n    while (bal.length <= dec) bal = '0' + bal;\n\n    bal = bal.slice(0, 0 - dec) + '.' + bal.slice(0 - dec);\n\n    while (bal[bal.length - 1] === '0') bal = bal.slice(0, -1);\n\n    if (bal[bal.length - 1] === '.') bal = bal.slice(0, -1);\n    return bal;\n  };\n\n  const parseAmount = (amt, dec) => {\n    let amount = amt;\n\n    if (amount.indexOf('.') < 0) {\n      for (let i = 0; i < dec; i++) {\n        amount = amount + '0';\n      }\n\n      return amount;\n    }\n\n    while (amount.length - amount.indexOf('.') <= dec) amount = amount + '0';\n\n    if (amount.length - amount.indexOf('.') > dec + 1) amount = amount.slice(0, amount.indexOf('.') + dec);\n    return amount.slice(0, amount.indexOf('.')) + amount.slice(amount.indexOf('.') + 1);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Form, {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Token Info\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Token Address: \", props.tokenAddress]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 39\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Token Name: \", tokenData.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 39\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Token Symbol: \", tokenData.symbol]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 39\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Account Address: \", tokenData.accountAddress]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 39\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Token Balance: \", formatBalance(tokenData.balance.toString(), tokenData.decimals), \" \", tokenData.symbol]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 39\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Transfer Tokens\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Recipient\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"text-input\",\n        value: transferRecipient,\n        onChange: event => setTransferRecipient(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 135\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Amount\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        value: transferAmount,\n        onChange: event => setTransferAmount(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        size: \"sm\",\n        variant: \"danger\",\n        onClick: () => transferTokens(transferRecipient, transferAmount),\n        children: \"Transfer\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Set Token Allowance\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Spender\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"text-input\",\n        value: allowanceSpender,\n        onChange: event => setAllowanceSpender(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 133\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Amount\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        value: allowanceAmount,\n        onChange: event => setAllowanceAmount(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        size: \"sm\",\n        variant: \"danger\",\n        onClick: () => setTokenAllowance(allowanceSpender, allowanceAmount),\n        children: \"Set Allowance\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Claim Allowance\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Owner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"text-input\",\n        value: claimOwner,\n        onChange: event => setClaimOwner(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 121\n      }, this), validAllowance && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: [\"Available Allowance: \", allowanceAvailable.toString(), \" \", tokenData.symbol]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 38\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 124\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Amount\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        value: claimAmount,\n        onChange: event => setClaimAmount(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        size: \"sm\",\n        variant: \"danger\",\n        onClick: () => transferAllowance(claimOwner, sendAllowance ? sendAddress : tokenData.accountAddress, claimAmount),\n        children: sendAllowance ? \"Send Allowance\" : \"Claim Allowance\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          checked: sendAllowance,\n          onChange: () => setSendAllowance(!sendAllowance)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 24\n        }, this), \" Send to another address\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 17\n      }, this), sendAllowance && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Destination address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"text-input\",\n          value: sendAddress,\n          onChange: event => setSendAddress(event.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-row btn-row\",\n      children: /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/token-builder/dashboard\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"secondary\",\n          onClick: props.reset,\n          children: \"Use a Different Token\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 174,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Dashboard, \"VpPQVapFqtVnd18NEvVoVNb9UAY=\");\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"sources":["/Users/jake/workspace/token-builder/src/Components/Dashboard.jsx"],"names":["React","useState","useEffect","ethers","Link","Form","Button","abi","rxAddress","Dashboard","props","tokenData","setTokenData","accountAddress","balance","name","symbol","decimals","transferRecipient","setTransferRecipient","transferAmount","setTransferAmount","allowanceSpender","setAllowanceSpender","allowanceAmount","setAllowanceAmount","allowanceAvailable","setAllowanceAvailable","validAllowance","setValidAllowance","claimOwner","setClaimOwner","claimAmount","setClaimAmount","sendAllowance","setSendAllowance","sendAddress","setSendAddress","provider","providers","Web3Provider","window","ethereum","send","signer","getSigner","erc20","Contract","tokenAddress","pUser","getAddress","pName","pSymbol","pDecimals","user","Promise","all","balanceOf","toString","filter","filters","Transfer","address","on","from","to","amount","event","console","log","JSON","stringify","bal","removeAllListeners","test","_allowance","allowance","formatBalance","err","error","transferTokens","recipient","transfer","parseAmount","e","alert","setTokenAllowance","sender","gte","approve","transferAllowance","owner","transferFrom","dec","length","slice","amt","indexOf","i","target","value","reset"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { ethers } from 'ethers'\nimport './dashboard.css';\nimport { Link } from 'react-router-dom';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button'\nimport abi from './abi'\n\nconst rxAddress = /^0x[a-fA-F0-9]{40}$/;\n\nconst Dashboard = (props) => {\n    const [tokenData, setTokenData] = useState({\n        accountAddress: '',\n        balance: '',\n        name: '',\n        symbol: '',\n        decimals: ''\n    });\n\n    const [transferRecipient, setTransferRecipient] = useState('');\n    const [transferAmount, setTransferAmount] = useState('');\n\n    const [allowanceSpender, setAllowanceSpender] = useState('');\n    const [allowanceAmount, setAllowanceAmount] = useState('');\n\n    const [allowanceAvailable, setAllowanceAvailable] = useState('');\n    const [validAllowance, setValidAllowance] = useState(false);\n\n    const [claimOwner, setClaimOwner] = useState('');\n    const [claimAmount, setClaimAmount] = useState('');\n    const [sendAllowance, setSendAllowance] = useState(false);\n    const [sendAddress, setSendAddress] = useState('');\n\n    useEffect(async () => {\n        const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n        await provider.send(\"eth_requestAccounts\", []);\n        const signer = provider.getSigner();\n        const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n        const pUser = signer.getAddress();\n        const pName = erc20.name();\n        const pSymbol = erc20.symbol();\n        const pDecimals = erc20.decimals();\n        const [user, name, symbol, decimals] = await Promise.all([pUser, pName, pSymbol, pDecimals]);\n        const balance = await erc20.balanceOf(user);\n        setTokenData({\n            accountAddress: user,\n            balance: balance.toString(),\n            name: name,\n            symbol: symbol,\n            decimals: decimals\n        });\n        const filter = erc20.filters.Transfer(signer.address);\n        erc20.on(filter, async (from, to, amount, event) => {\n            console.log(JSON.stringify(tokenData))\n            const bal = await erc20.balanceOf(await signer.address);\n            setTokenData({...tokenData, balance: bal.toString()});\n        });\n        provider.provider.on(\"accountsChanged\", async () => {\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const pUser = signer.getAddress();\n            const pName = erc20.name();\n            const pSymbol = erc20.symbol();\n            const pDecimals = erc20.decimals();\n            const [user, name, symbol, decimals] = await Promise.all([pUser, pName, pSymbol, pDecimals]);\n            const balance = await erc20.balanceOf(user);\n            setTokenData({\n                accountAddress: user,\n                balance: balance.toString(),\n                name: name,\n                symbol: symbol,\n                decimals: decimals\n            });\n        });\n        return (()=>{\n            erc20.removeAllListeners();\n        });\n    }, []);\n\n    useEffect(async () => {\n        if (rxAddress.test(claimOwner)) {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const decimals = await erc20.decimals();\n            try {\n                const _allowance = await erc20.allowance(claimOwner, await signer.getAddress());\n                setAllowanceAvailable(formatBalance(_allowance.toString(), decimals));\n                setValidAllowance(true);\n            } catch(err) {\n                console.error(err);\n            }\n        }\n        else setValidAllowance(false);\n    }, [claimOwner]);\n\n    const transferTokens = async (recipient, amount) => {\n        try {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const decimals = await erc20.decimals();\n            await erc20.transfer(recipient, parseAmount(amount, decimals));\n        } catch (e) { \n            console.error(e);\n            alert('Error: Transfer failed.');\n        }\n    }\n\n    const setTokenAllowance = async (recipient, amount) => {\n        try {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const sender = await signer.getAddress();\n            const balance = await erc20.balanceOf(sender);\n            const decimals = await erc20.decimals();\n            if (balance.gte(parseAmount(amount, decimals))) {\n                await erc20.approve(recipient, parseAmount(amount, decimals));\n            }\n            else alert(\"Error: Insufficient balance.\")\n        } catch (e) { \n            console.error(e);\n            alert('Error: Allowance failed.');\n        }\n    }\n\n    const transferAllowance = async (owner, recipient, amount) => {\n        try {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const balance = await erc20.balanceOf(owner);\n            const decimals = await erc20.decimals();\n            if (balance >= formatBalance(amount, decimals) ) {\n                await erc20.transferFrom(owner, recipient, parseAmount(amount, decimals));\n            }\n            const _allowance = await erc20.allowance(owner, recipient);\n            setAllowanceAvailable(formatBalance(_allowance.toString(), decimals));\n        } catch (e) { \n            console.error(e);\n            alert('Error: Transfer failed.');\n        }\n    }\n\n    const formatBalance = (balance, dec) => {\n        if (dec === 0) return balance;\n        let bal = balance;\n        while (bal.length <= dec) bal = '0'+bal;\n        bal = bal.slice(0,0-dec)+'.'+bal.slice(0-dec);\n        while (bal[bal.length-1] === '0') bal = bal.slice(0,-1);\n        if (bal[bal.length-1] === '.') bal = bal.slice(0,-1);\n        return bal;\n    }\n\n    const parseAmount = (amt, dec) => {\n        let amount = amt;\n        if (amount.indexOf('.') < 0) {\n            for (let i=0; i<dec; i++) {\n                amount=amount+'0';\n            }\n            return amount;\n        }\n        while (amount.length-amount.indexOf('.') <= dec) amount=amount+'0';\n        if (amount.length-amount.indexOf('.') > dec+1) amount = amount.slice(0,amount.indexOf('.')+dec);\n        return amount.slice(0,amount.indexOf('.'))+amount.slice(amount.indexOf('.')+1);\n    }\n\n    return (\n        <Form>\n            <h3>Token Info</h3>\n            <div className=\"form-row\"><label>Token Address: {props.tokenAddress}</label></div>\n            <div className=\"form-row\"><label>Token Name: {tokenData.name}</label></div>\n            <div className=\"form-row\"><label>Token Symbol: {tokenData.symbol}</label></div>\n            <div className=\"form-row\"><label>Account Address: {tokenData.accountAddress}</label></div>\n            <div className=\"form-row\"><label>Token Balance: {formatBalance(tokenData.balance.toString(), tokenData.decimals)} {tokenData.symbol}</label></div>\n            <hr/>\n            <h3>Transfer Tokens</h3>\n            <div className=\"form-row\">\n                <label>Recipient</label>\n                <input className=\"text-input\" value={transferRecipient} onChange={(event)=>setTransferRecipient(event.target.value)}/><br/>\n                <label>Amount</label>\n                <input type=\"number\" value={transferAmount} onChange={(event)=>setTransferAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => transferTokens(transferRecipient, transferAmount)}>Transfer</Button>\n            </div>\n            <hr/>\n            <h3>Set Token Allowance</h3>\n            <div className=\"form-row\">\n                <label>Spender</label>\n                <input className=\"text-input\" value={allowanceSpender} onChange={(event)=>setAllowanceSpender(event.target.value)}/><br/>\n                <label>Amount</label>\n                <input type=\"number\" value={allowanceAmount} onChange={(event)=>setAllowanceAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => setTokenAllowance(allowanceSpender, allowanceAmount)}>Set Allowance</Button>\n            </div>\n            <hr/>\n            <h3>Claim Allowance</h3>\n            <div className=\"form-row\">\n                <label>Owner</label>\n                <input className=\"text-input\" value={claimOwner} onChange={(event)=>setClaimOwner(event.target.value)}/><br/>\n                {validAllowance && <><label>Available Allowance: {allowanceAvailable.toString()} {tokenData.symbol}</label><br/></>}\n                <label>Amount</label>\n                <input type=\"number\" value={claimAmount} onChange={(event)=>setClaimAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => transferAllowance(claimOwner, (sendAllowance ? sendAddress : tokenData.accountAddress), claimAmount)}>{sendAllowance ? \"Send Allowance\" : \"Claim Allowance\"}</Button>\n                <label><input type=\"checkbox\" checked={sendAllowance} onChange={()=>setSendAllowance(!sendAllowance)}/> Send to another address</label>\n                {sendAllowance &&\n                    <div>\n                        <label>Destination address</label>\n                        <input className=\"text-input\" value={sendAddress} onChange={(event)=>setSendAddress(event.target.value)}/>\n                    </div>}\n            </div>\n            <div className=\"form-row btn-row\">\n                <Link to=\"/token-builder/dashboard\">\n                    <Button variant=\"secondary\" onClick={props.reset}>Use a Different Token</Button>\n                </Link>\n            </div>\n        </Form>\n    )\n}\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}