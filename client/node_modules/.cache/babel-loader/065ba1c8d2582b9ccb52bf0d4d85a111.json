{"ast":null,"code":"import _objectSpread from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from'react';import{ethers}from'ethers';import'./dashboard.css';import{Link}from'react-router-dom';import Form from'react-bootstrap/Form';import Button from'react-bootstrap/Button';import abi from'./abi';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var rxAddress=/^0x[a-fA-F0-9]{40}$/;var Dashboard=function Dashboard(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),transferRecipient=_useState2[0],setTransferRecipient=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),transferAmount=_useState4[0],setTransferAmount=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),allowanceSpender=_useState6[0],setAllowanceSpender=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),allowanceAmount=_useState8[0],setAllowanceAmount=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),allowanceAvailable=_useState10[0],setAllowanceAvailable=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),validAllowance=_useState12[0],setValidAllowance=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),claimOwner=_useState14[0],setClaimOwner=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),claimAmount=_useState16[0],setClaimAmount=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),sendAllowance=_useState18[0],setSendAllowance=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),sendAddress=_useState20[0],setSendAddress=_useState20[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var decimals,_allowance;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!rxAddress.test(claimOwner)){_context.next=22;break;}_context.next=3;return props.web3.contract.decimals();case 3:decimals=_context.sent;_context.prev=4;_context.t0=props.web3.contract;_context.t1=claimOwner;_context.next=9;return props.web3.signer.getAddress();case 9:_context.t2=_context.sent;_context.next=12;return _context.t0.allowance.call(_context.t0,_context.t1,_context.t2);case 12:_allowance=_context.sent;setAllowanceAvailable(formatBalance(_allowance.toString(),decimals));setValidAllowance(true);_context.next=20;break;case 17:_context.prev=17;_context.t3=_context[\"catch\"](4);console.error(_context.t3);case 20:_context.next=23;break;case 22:setValidAllowance(false);case 23:case\"end\":return _context.stop();}}},_callee,null,[[4,17]]);})),[claimOwner]);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var filter,filter2;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// transfer()\nfilter=props.web3.contract.filters.Transfer(props.tokenData.accountAddress);props.web3.contract.on(filter,/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(from,to,amount,event){var bal;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return props.web3.contract.balanceOf(props.tokenData.accountAddress);case 2:bal=_context2.sent;props.updateTokenData(_objectSpread(_objectSpread({},props.tokenData),{},{balance:bal.toString()}));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2,_x3,_x4){return _ref3.apply(this,arguments);};}());// transferFrom()\nfilter2=props.web3.contract.filters.Transfer(null,props.tokenData.accountAddress);props.web3.contract.on(filter2,/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(from,to,amount,event){var bal,dec,_allowance;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return props.web3.contract.balanceOf(props.tokenData.accountAddress);case 2:bal=_context3.sent;_context3.next=5;return props.web3.contract.decimals();case 5:dec=_context3.sent;props.updateTokenData(_objectSpread(_objectSpread({},props.tokenData),{},{balance:bal.toString()}));_context3.next=9;return props.web3.contract.allowance(from,to);case 9:_allowance=_context3.sent;setAllowanceAvailable(formatBalance(_allowance.toString(),dec));case 11:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x5,_x6,_x7,_x8){return _ref4.apply(this,arguments);};}());return _context4.abrupt(\"return\",function(){props.web3.contract.removeAllListeners();});case 5:case\"end\":return _context4.stop();}}},_callee4);})),[props.tokenData.accountAddress]);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:props.web3.provider.provider.on(\"accountsChanged\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var signer,pUser,pName,pSymbol,pDecimals,_yield$Promise$all,_yield$Promise$all2,user,name,symbol,decimals,balance;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:signer=props.web3.provider.getSigner();pUser=signer.getAddress();pName=props.web3.contract.name();pSymbol=props.web3.contract.symbol();pDecimals=props.web3.contract.decimals();_context5.next=7;return Promise.all([pUser,pName,pSymbol,pDecimals]);case 7:_yield$Promise$all=_context5.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,4);user=_yield$Promise$all2[0];name=_yield$Promise$all2[1];symbol=_yield$Promise$all2[2];decimals=_yield$Promise$all2[3];_context5.next=15;return props.web3.contract.balanceOf(user);case 15:balance=_context5.sent;props.updateTokenData({accountAddress:user,balance:balance.toString(),name:name,symbol:symbol,decimals:decimals});case 17:case\"end\":return _context5.stop();}}},_callee5);})));case 1:case\"end\":return _context6.stop();}}},_callee6);})),[]);var transferTokens=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(recipient,amount){var decimals;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return props.web3.contract.decimals();case 3:decimals=_context7.sent;_context7.next=6;return props.web3.contract.transfer(recipient,parseAmount(amount,decimals));case 6:_context7.next=12;break;case 8:_context7.prev=8;_context7.t0=_context7[\"catch\"](0);console.error(_context7.t0);alert('Error: Transfer failed.');case 12:case\"end\":return _context7.stop();}}},_callee7,null,[[0,8]]);}));return function transferTokens(_x9,_x10){return _ref7.apply(this,arguments);};}();var setTokenAllowance=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(recipient,amount){var sender,balance,decimals;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;_context8.next=3;return props.web3.signer.getAddress();case 3:sender=_context8.sent;_context8.next=6;return props.web3.contract.balanceOf(sender);case 6:balance=_context8.sent;_context8.next=9;return props.web3.contract.decimals();case 9:decimals=_context8.sent;if(!(balance>=formatBalance(amount,decimals))){_context8.next=15;break;}_context8.next=13;return props.web3.contract.approve(recipient,parseAmount(amount,decimals));case 13:_context8.next=16;break;case 15:alert(\"Error: Insufficient balance.\");case 16:_context8.next=22;break;case 18:_context8.prev=18;_context8.t0=_context8[\"catch\"](0);console.error(_context8.t0);alert('Error: Allowance failed.');case 22:case\"end\":return _context8.stop();}}},_callee8,null,[[0,18]]);}));return function setTokenAllowance(_x11,_x12){return _ref8.apply(this,arguments);};}();var transferAllowance=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(owner,recipient,amount){var balance,decimals;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;_context9.next=3;return props.web3.contract.balanceOf(owner);case 3:balance=_context9.sent;_context9.next=6;return props.web3.contract.decimals();case 6:decimals=_context9.sent;if(!(balance>=formatBalance(amount,decimals))){_context9.next=10;break;}_context9.next=10;return props.web3.contract.transferFrom(owner,recipient,parseAmount(amount,decimals));case 10:_context9.next=16;break;case 12:_context9.prev=12;_context9.t0=_context9[\"catch\"](0);console.error(_context9.t0);alert('Error: Transfer failed.');case 16:case\"end\":return _context9.stop();}}},_callee9,null,[[0,12]]);}));return function transferAllowance(_x13,_x14,_x15){return _ref9.apply(this,arguments);};}();var formatBalance=function formatBalance(balance,dec){if(dec===0)return balance;var bal=balance;while(bal.length<=dec){bal='0'+bal;}bal=bal.slice(0,0-dec)+'.'+bal.slice(0-dec);while(bal[bal.length-1]==='0'){bal=bal.slice(0,-1);}if(bal[bal.length-1]==='.')bal=bal.slice(0,-1);return bal;};var parseAmount=function parseAmount(amt,dec){var amount=amt;if(amount.indexOf('.')<0){for(var i=0;i<dec;i++){amount=amount+'0';}return amount;}while(amount.length-amount.indexOf('.')<=dec){amount=amount+'0';}if(amount.length-amount.indexOf('.')>dec+1)amount=amount.slice(0,amount.indexOf('.')+dec);return amount.slice(0,amount.indexOf('.'))+amount.slice(amount.indexOf('.')+1);};return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Token Info\"}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Address: \",props.tokenAddress]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Name: \",props.tokenData.name]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Symbol: \",props.tokenData.symbol]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Account Address: \",props.tokenData.accountAddress]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Balance: \",formatBalance(props.tokenData.balance.toString(),props.tokenData.decimals),\" \",props.tokenData.symbol]})}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h3\",{children:\"Transfer Tokens\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Recipient\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:transferRecipient,onChange:function onChange(event){return setTransferRecipient(event.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:transferAmount,onChange:function onChange(event){return setTransferAmount(event.target.value);}}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"danger\",onClick:function onClick(){return transferTokens(transferRecipient,transferAmount);},children:\"Transfer\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h3\",{children:\"Set Token Allowance\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Spender\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:allowanceSpender,onChange:function onChange(event){return setAllowanceSpender(event.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:allowanceAmount,onChange:function onChange(event){return setAllowanceAmount(event.target.value);}}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"danger\",onClick:function onClick(){return setTokenAllowance(allowanceSpender,allowanceAmount);},children:\"Set Allowance\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h3\",{children:\"Claim Allowance\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Owner\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:claimOwner,onChange:function onChange(event){return setClaimOwner(event.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),validAllowance&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Available Allowance: \",allowanceAvailable,\" \",props.tokenData.symbol]}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:claimAmount,onChange:function onChange(event){return setClaimAmount(event.target.value);}}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"danger\",onClick:function onClick(){return transferAllowance(claimOwner,sendAllowance?sendAddress:props.tokenData.accountAddress,claimAmount);},children:sendAllowance?\"Send Allowance\":\"Claim Allowance\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row btn-row\",children:/*#__PURE__*/_jsx(Link,{to:\"/token-builder/dashboard\",children:/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:props.reset,children:\"Use a Different Token\"})})})]});};export default Dashboard;","map":{"version":3,"sources":["/Users/jake/workspace/token-builder/src/Components/Dashboard.jsx"],"names":["React","useState","useEffect","ethers","Link","Form","Button","abi","rxAddress","Dashboard","props","transferRecipient","setTransferRecipient","transferAmount","setTransferAmount","allowanceSpender","setAllowanceSpender","allowanceAmount","setAllowanceAmount","allowanceAvailable","setAllowanceAvailable","validAllowance","setValidAllowance","claimOwner","setClaimOwner","claimAmount","setClaimAmount","sendAllowance","setSendAllowance","sendAddress","setSendAddress","test","web3","contract","decimals","signer","getAddress","allowance","_allowance","formatBalance","toString","console","error","filter","filters","Transfer","tokenData","accountAddress","on","from","to","amount","event","balanceOf","bal","updateTokenData","balance","filter2","dec","removeAllListeners","provider","getSigner","pUser","pName","name","pSymbol","symbol","pDecimals","Promise","all","user","transferTokens","recipient","transfer","parseAmount","alert","setTokenAllowance","sender","approve","transferAllowance","owner","transferFrom","length","slice","amt","indexOf","i","tokenAddress","target","value","reset"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { ethers } from 'ethers'\nimport './dashboard.css';\nimport { Link } from 'react-router-dom';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button'\nimport abi from './abi'\n\nconst rxAddress = /^0x[a-fA-F0-9]{40}$/;\n\nconst Dashboard = (props) => {\n    const [transferRecipient, setTransferRecipient] = useState('');\n    const [transferAmount, setTransferAmount] = useState('');\n\n    const [allowanceSpender, setAllowanceSpender] = useState('');\n    const [allowanceAmount, setAllowanceAmount] = useState('');\n\n    const [allowanceAvailable, setAllowanceAvailable] = useState('');\n    const [validAllowance, setValidAllowance] = useState(false);\n\n    const [claimOwner, setClaimOwner] = useState('');\n    const [claimAmount, setClaimAmount] = useState('');\n    const [sendAllowance, setSendAllowance] = useState(false);\n    const [sendAddress, setSendAddress] = useState('');\n\n    useEffect(async () => {\n        if (rxAddress.test(claimOwner)) {\n            const decimals = await props.web3.contract.decimals();\n            try {\n                const _allowance = await props.web3.contract.allowance(claimOwner, await props.web3.signer.getAddress());\n                setAllowanceAvailable(formatBalance(_allowance.toString(), decimals));\n                setValidAllowance(true);\n            } catch(err) {\n                console.error(err);\n            }\n        }\n        else setValidAllowance(false);\n    }, [claimOwner]);\n\n    useEffect(async () => {\n        // transfer()\n        const filter = props.web3.contract.filters.Transfer(props.tokenData.accountAddress);\n        props.web3.contract.on(filter, async (from, to, amount, event) => {\n            const bal = await props.web3.contract.balanceOf(props.tokenData.accountAddress);\n            props.updateTokenData({...props.tokenData, balance: bal.toString()});\n        });\n        // transferFrom()\n        const filter2 = props.web3.contract.filters.Transfer(null, props.tokenData.accountAddress);\n        props.web3.contract.on(filter2, async (from, to, amount, event) => {\n            const bal = await props.web3.contract.balanceOf(props.tokenData.accountAddress);\n            const dec = await props.web3.contract.decimals();\n            props.updateTokenData({...props.tokenData, balance: bal.toString()});\n            const _allowance = await props.web3.contract.allowance(from, to);\n            setAllowanceAvailable(formatBalance(_allowance.toString(), dec));\n        });\n        return (()=>{\n            props.web3.contract.removeAllListeners();\n        });\n    }, [props.tokenData.accountAddress]);\n\n    useEffect(async () => {\n        props.web3.provider.provider.on(\"accountsChanged\", async () => {\n            const signer = props.web3.provider.getSigner();\n            const pUser = signer.getAddress();\n            const pName = props.web3.contract.name();\n            const pSymbol = props.web3.contract.symbol();\n            const pDecimals = props.web3.contract.decimals();\n            const [user, name, symbol, decimals] = await Promise.all([pUser, pName, pSymbol, pDecimals]);\n            const balance = await props.web3.contract.balanceOf(user);\n            props.updateTokenData({\n                accountAddress: user,\n                balance: balance.toString(),\n                name: name,\n                symbol: symbol,\n                decimals: decimals\n            });\n        });\n    }, []);\n\n    const transferTokens = async (recipient, amount) => {\n        try {\n            const decimals = await props.web3.contract.decimals();\n            await props.web3.contract.transfer(recipient, parseAmount(amount, decimals));\n        } catch (e) { \n            console.error(e);\n            alert('Error: Transfer failed.');\n        }\n    }\n\n    const setTokenAllowance = async (recipient, amount) => {\n        try {\n            const sender = await props.web3.signer.getAddress();\n            const balance = await props.web3.contract.balanceOf(sender);\n            const decimals = await props.web3.contract.decimals();\n            if (balance >= formatBalance(amount, decimals)) {\n                await props.web3.contract.approve(recipient, parseAmount(amount, decimals));\n            }\n            else alert(\"Error: Insufficient balance.\")\n        } catch (e) { \n            console.error(e);\n            alert('Error: Allowance failed.');\n        }\n    }\n\n    const transferAllowance = async (owner, recipient, amount) => {\n        try {\n            const balance = await props.web3.contract.balanceOf(owner);\n            const decimals = await props.web3.contract.decimals();\n            if (balance >= formatBalance(amount, decimals) ) {\n                await props.web3.contract.transferFrom(owner, recipient, parseAmount(amount, decimals));\n            }\n        } catch (e) { \n            console.error(e);\n            alert('Error: Transfer failed.');\n        }\n    }\n\n    const formatBalance = (balance, dec) => {\n        if (dec === 0) return balance;\n        let bal = balance;\n        while (bal.length <= dec) bal = '0'+bal;\n        bal = bal.slice(0,0-dec)+'.'+bal.slice(0-dec);\n        while (bal[bal.length-1] === '0') bal = bal.slice(0,-1);\n        if (bal[bal.length-1] === '.') bal = bal.slice(0,-1);\n        return bal;\n    }\n\n    const parseAmount = (amt, dec) => {\n        let amount = amt;\n        if (amount.indexOf('.') < 0) {\n            for (let i=0; i<dec; i++) {\n                amount=amount+'0';\n            }\n            return amount;\n        }\n        while (amount.length-amount.indexOf('.') <= dec) amount=amount+'0';\n        if (amount.length-amount.indexOf('.') > dec+1) amount = amount.slice(0,amount.indexOf('.')+dec);\n        return amount.slice(0,amount.indexOf('.'))+amount.slice(amount.indexOf('.')+1);\n    }\n\n    return (\n        <Form>\n            <h3>Token Info</h3>\n            <div className=\"form-row\"><label>Token Address: {props.tokenAddress}</label></div>\n            <div className=\"form-row\"><label>Token Name: {props.tokenData.name}</label></div>\n            <div className=\"form-row\"><label>Token Symbol: {props.tokenData.symbol}</label></div>\n            <div className=\"form-row\"><label>Account Address: {props.tokenData.accountAddress}</label></div>\n            <div className=\"form-row\"><label>Token Balance: {formatBalance(props.tokenData.balance.toString(), props.tokenData.decimals)} {props.tokenData.symbol}</label></div>\n            <hr/>\n            <h3>Transfer Tokens</h3>\n            <div className=\"form-row\">\n                <label>Recipient</label>\n                <input className=\"text-input\" value={transferRecipient} onChange={(event)=>setTransferRecipient(event.target.value)}/><br/>\n                <label>Amount</label>\n                <input type=\"number\" value={transferAmount} onChange={(event)=>setTransferAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => transferTokens(transferRecipient, transferAmount)}>Transfer</Button>\n            </div>\n            <hr/>\n            <h3>Set Token Allowance</h3>\n            <div className=\"form-row\">\n                <label>Spender</label>\n                <input className=\"text-input\" value={allowanceSpender} onChange={(event)=>setAllowanceSpender(event.target.value)}/><br/>\n                <label>Amount</label>\n                <input type=\"number\" value={allowanceAmount} onChange={(event)=>setAllowanceAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => setTokenAllowance(allowanceSpender, allowanceAmount)}>Set Allowance</Button>\n            </div>\n            <hr/>\n            <h3>Claim Allowance</h3>\n            <div className=\"form-row\">\n                <label>Owner</label>\n                <input className=\"text-input\" value={claimOwner} onChange={(event)=>setClaimOwner(event.target.value)}/><br/>\n                {validAllowance && <div><label>Available Allowance: {allowanceAvailable} {props.tokenData.symbol}</label><br/></div>}\n                <label>Amount</label>\n                <input type=\"number\" value={claimAmount} onChange={(event)=>setClaimAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => transferAllowance(claimOwner, (sendAllowance ? sendAddress : props.tokenData.accountAddress), claimAmount)}>{sendAllowance ? \"Send Allowance\" : \"Claim Allowance\"}</Button>\n                {/*<label><input type=\"checkbox\" checked={sendAllowance} onChange={()=>setSendAllowance(!sendAllowance)}/> Send to another address</label>*/}\n                {/*sendAllowance &&\n                    <div>\n                        <label>Destination address</label>\n                        <input className=\"text-input\" value={sendAddress} onChange={(event)=>setSendAddress(event.target.value)}/>\n                    </div>*/}\n            </div>\n            <div className=\"form-row btn-row\">\n                <Link to=\"/token-builder/dashboard\">\n                    <Button variant=\"secondary\" onClick={props.reset}>Use a Different Token</Button>\n                </Link>\n            </div>\n        </Form>\n    )\n}\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}