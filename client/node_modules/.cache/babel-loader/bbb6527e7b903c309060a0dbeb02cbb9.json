{"ast":null,"code":"import _objectSpread from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/jake/workspace/token-builder/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from'react';import{ethers}from'ethers';import'./dashboard.css';import{Link}from'react-router-dom';import Card from'react-bootstrap/Card';import Form from'react-bootstrap/Form';import Button from'react-bootstrap/Button';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var abi=[\"function allowance(address owner, address spender) view returns (uint256)\",\"function balanceOf(address owner) view returns (uint256)\",\"function decimals() view returns (uint8)\",\"function name() view returns (string)\",\"function symbol() view returns (string)\",\"function transfer(address to, uint amount) returns (bool)\",\"function transferFrom(address from, address to, uint256 amount) returns (bool)\",\"function approve(address spender, uint256 amount) returns (bool)\",\"event Approval(address indexed owner, address indexed spender, uint256 value)\",\"event Transfer(address indexed from, address indexed to, uint amount)\"];var Dashboard=function Dashboard(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),transferRecipient=_useState2[0],setTransferRecipient=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),transferAmount=_useState4[0],setTransferAmount=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),allowanceSpender=_useState6[0],setAllowanceSpender=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),allowanceAmount=_useState8[0],setAllowanceAmount=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),allowanceAvailable=_useState10[0],setAllowanceAvailable=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),validAllowance=_useState12[0],setValidAllowance=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),claimOwner=_useState14[0],setClaimOwner=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),claimAmount=_useState16[0],setClaimAmount=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),sendAllowance=_useState18[0],setSendAllowance=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),sendAddress=_useState20[0],setSendAddress=_useState20[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var provider,signer,erc20,filter;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");_context2.next=3;return provider.send(\"eth_requestAccounts\",[]);case 3:signer=provider.getSigner();erc20=new ethers.Contract(props.tokenAddress,abi,signer);filter=erc20.filters.Transfer(signer.address);erc20.on(filter,/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(from,to,amount,event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=props;_context.t1=_objectSpread;_context.t2=_objectSpread({},props.tokenData);_context.t3={};_context.next=6;return erc20.balanceOf(props.tokenData.accountAddress);case 6:_context.t4=_context.sent;_context.t5={balance:_context.t4};_context.t6=(0,_context.t1)(_context.t2,_context.t3,_context.t5);_context.t0.setTokenData.call(_context.t0,_context.t6);case 10:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2,_x3,_x4){return _ref2.apply(this,arguments);};}());return _context2.abrupt(\"return\",function(){erc20.removeAllListeners();});case 8:case\"end\":return _context2.stop();}}},_callee2);})),[]);useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var provider,signer,erc20,decimals,_allowance;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!/^0x[a-fA-F0-9]{40}$/.test(claimOwner)){_context3.next=28;break;}console.log(\"match\");provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");_context3.next=5;return provider.send(\"eth_requestAccounts\",[]);case 5:signer=provider.getSigner();erc20=new ethers.Contract(props.tokenAddress,abi,signer);_context3.next=9;return erc20.decimals();case 9:decimals=_context3.sent;_context3.prev=10;_context3.t0=erc20;_context3.t1=claimOwner;_context3.next=15;return signer.getAddress();case 15:_context3.t2=_context3.sent;_context3.next=18;return _context3.t0.allowance.call(_context3.t0,_context3.t1,_context3.t2);case 18:_allowance=_context3.sent;setAllowanceAvailable(formatBalance(_allowance.toString(),decimals));setValidAllowance(true);_context3.next=26;break;case 23:_context3.prev=23;_context3.t3=_context3[\"catch\"](10);console.error(_context3.t3);case 26:_context3.next=29;break;case 28:setValidAllowance(false);case 29:case\"end\":return _context3.stop();}}},_callee3,null,[[10,23]]);})),[claimOwner]);var transferTokens=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(recipient,amount){var provider,signer,erc20,sender,balance,decimals,success;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");_context4.next=4;return provider.send(\"eth_requestAccounts\",[]);case 4:signer=provider.getSigner();erc20=new ethers.Contract(props.tokenAddress,abi,signer);_context4.next=8;return signer.getAddress();case 8:sender=_context4.sent;_context4.next=11;return erc20.balanceOf(sender);case 11:balance=_context4.sent;_context4.next=14;return erc20.decimals();case 14:decimals=_context4.sent;_context4.next=17;return erc20.transfer(recipient,parseAmount(amount,decimals));case 17:success=_context4.sent;console.log(success);_context4.next=25;break;case 21:_context4.prev=21;_context4.t0=_context4[\"catch\"](0);console.error(_context4.t0);alert('Error: Transfer failed.');case 25:case\"end\":return _context4.stop();}}},_callee4,null,[[0,21]]);}));return function transferTokens(_x5,_x6){return _ref4.apply(this,arguments);};}();var setTokenAllowance=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(recipient,amount){var provider,signer,erc20,sender,balance,decimals,success,allowance;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");_context5.next=4;return provider.send(\"eth_requestAccounts\",[]);case 4:signer=provider.getSigner();erc20=new ethers.Contract(props.tokenAddress,abi,signer);_context5.next=8;return signer.getAddress();case 8:sender=_context5.sent;_context5.next=11;return erc20.balanceOf(sender);case 11:balance=_context5.sent;_context5.next=14;return erc20.decimals();case 14:decimals=_context5.sent;success=false;if(!balance.gte(parseAmount(amount,decimals))){_context5.next=22;break;}_context5.next=19;return erc20.approve(recipient,parseAmount(amount,decimals));case 19:success=_context5.sent;_context5.next=23;break;case 22:alert(\"Error: Insufficient balance.\");case 23:_context5.next=25;return erc20.allowance(sender,recipient);case 25:allowance=_context5.sent;_context5.next=32;break;case 28:_context5.prev=28;_context5.t0=_context5[\"catch\"](0);console.error(_context5.t0);alert('Error: Allowance failed.');case 32:case\"end\":return _context5.stop();}}},_callee5,null,[[0,28]]);}));return function setTokenAllowance(_x7,_x8){return _ref5.apply(this,arguments);};}();var transferAllowance=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(owner,recipient,amount){var provider,signer,erc20,spender,balance,allowance,decimals,success;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;provider=new ethers.providers.Web3Provider(window.ethereum,\"any\");_context6.next=4;return provider.send(\"eth_requestAccounts\",[]);case 4:signer=provider.getSigner();erc20=new ethers.Contract(props.tokenAddress,abi,signer);_context6.next=8;return signer.getAddress();case 8:spender=_context6.sent;_context6.next=11;return erc20.balanceOf(owner);case 11:balance=_context6.sent;_context6.next=14;return erc20.allowance(owner,spender);case 14:allowance=_context6.sent;_context6.next=17;return erc20.decimals();case 17:decimals=_context6.sent;success=false;if(!(balance>=parseAmount(amount,decimals))){_context6.next=23;break;}_context6.next=22;return erc20.transferFrom(owner,recipient,parseAmount(amount,decimals));case 22:success=_context6.sent;case 23:console.log(success);_context6.next=30;break;case 26:_context6.prev=26;_context6.t0=_context6[\"catch\"](0);console.error(_context6.t0);alert('Error: Transfer failed.');case 30:case\"end\":return _context6.stop();}}},_callee6,null,[[0,26]]);}));return function transferAllowance(_x9,_x10,_x11){return _ref6.apply(this,arguments);};}();var formatBalance=function formatBalance(balance,dec){if(dec===0)return balance;var bal=balance;while(bal.length<=dec){bal='0'+bal;}bal=bal.slice(0,0-dec)+'.'+bal.slice(0-dec);while(bal[bal.length-1]==='0'){bal=bal.slice(0,-1);}if(bal[bal.length-1]==='.')bal=bal.slice(0,-1);return bal;};var parseAmount=function parseAmount(amt,dec){var amount=amt;if(amount.indexOf('.')<0){for(var i=0;i<dec;i++){amount=amount+'0';}return amount;}while(amount.length-amount.indexOf('.')<=dec){amount=amount+'0';}if(amount.length-amount.indexOf('.')>dec+1)amount=amount.slice(0,amount.indexOf('.')+dec);return amount.slice(0,amount.indexOf('.'))+amount.slice(amount.indexOf('.')+1);};return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Token Info\"}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Address: \",props.tokenAddress]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Name: \",props.tokenData.name]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Symbol: \",props.tokenData.symbol]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Account Address: \",props.tokenData.accountAddress]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Token Balance: \",formatBalance(props.tokenData.balance.toString(),props.tokenData.decimals),\" \",props.tokenData.symbol]})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Transfer Tokens\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Recipient\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:transferRecipient,onChange:function onChange(event){return setTransferRecipient(event.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:transferAmount,onChange:function onChange(event){return setTransferAmount(event.target.value);}}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"danger\",onClick:function onClick(){return transferTokens(transferRecipient,transferAmount);},children:\"Transfer\"})]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Set Token Allowance\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Spender\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:allowanceSpender,onChange:function onChange(event){return setAllowanceSpender(event.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:allowanceAmount,onChange:function onChange(event){return setAllowanceAmount(event.target.value);}}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"danger\",onClick:function onClick(){return setTokenAllowance(allowanceSpender,allowanceAmount);},children:\"Set Allowance\"})]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Claim Allowance\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Owner\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:claimOwner,onChange:function onChange(event){return setClaimOwner(event.target.value);}}),/*#__PURE__*/_jsx(\"br\",{}),validAllowance&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Available Allowance: \",allowanceAvailable.toString()]}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:claimAmount,onChange:function onChange(event){return setClaimAmount(event.target.value);}}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"danger\",onClick:function onClick(){return transferAllowance(claimOwner,sendAllowance?sendAddress:props.tokenData.accountAddress,claimAmount);},children:sendAllowance?\"Send Allowance\":\"Claim Allowance\"}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:sendAllowance,onChange:function onChange(){return setSendAllowance(!sendAllowance);}}),\" Send to another address\"]}),sendAllowance&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Destination address\"}),/*#__PURE__*/_jsx(\"input\",{className:\"text-input\",value:sendAddress,onChange:function onChange(event){return setSendAddress(event.target.value);}})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row btn-row\",children:/*#__PURE__*/_jsx(Link,{to:\"/token-builder/dashboard\",children:/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:props.reset,children:\"Use a Different Token\"})})})]});};export default Dashboard;","map":{"version":3,"sources":["/Users/jake/workspace/token-builder/src/Components/Dashboard.jsx"],"names":["React","useState","useEffect","ethers","Link","Card","Form","Button","abi","Dashboard","props","transferRecipient","setTransferRecipient","transferAmount","setTransferAmount","allowanceSpender","setAllowanceSpender","allowanceAmount","setAllowanceAmount","allowanceAvailable","setAllowanceAvailable","validAllowance","setValidAllowance","claimOwner","setClaimOwner","claimAmount","setClaimAmount","sendAllowance","setSendAllowance","sendAddress","setSendAddress","provider","providers","Web3Provider","window","ethereum","send","signer","getSigner","erc20","Contract","tokenAddress","filter","filters","Transfer","address","on","from","to","amount","event","tokenData","balanceOf","accountAddress","balance","setTokenData","removeAllListeners","test","console","log","decimals","getAddress","allowance","_allowance","formatBalance","toString","error","transferTokens","recipient","sender","transfer","parseAmount","success","alert","setTokenAllowance","gte","approve","transferAllowance","owner","spender","transferFrom","dec","bal","length","slice","amt","indexOf","i","name","symbol","target","value","reset"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { ethers } from 'ethers'\nimport './dashboard.css';\nimport { Link } from 'react-router-dom';\nimport Card from 'react-bootstrap/Card';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button'\n\nconst abi = [\n    \"function allowance(address owner, address spender) view returns (uint256)\",\n    \"function balanceOf(address owner) view returns (uint256)\",\n    \"function decimals() view returns (uint8)\",\n    \"function name() view returns (string)\",\n    \"function symbol() view returns (string)\",\n    \"function transfer(address to, uint amount) returns (bool)\",\n    \"function transferFrom(address from, address to, uint256 amount) returns (bool)\",\n    \"function approve(address spender, uint256 amount) returns (bool)\",\n    \"event Approval(address indexed owner, address indexed spender, uint256 value)\",\n    \"event Transfer(address indexed from, address indexed to, uint amount)\"\n];\n\nconst Dashboard = (props) => {\n\n    const [transferRecipient, setTransferRecipient] = useState('');\n    const [transferAmount, setTransferAmount] = useState('');\n\n    const [allowanceSpender, setAllowanceSpender] = useState('');\n    const [allowanceAmount, setAllowanceAmount] = useState('');\n\n    const [allowanceAvailable, setAllowanceAvailable] = useState('');\n    const [validAllowance, setValidAllowance] = useState(false);\n\n    const [claimOwner, setClaimOwner] = useState('');\n    const [claimAmount, setClaimAmount] = useState('');\n    const [sendAllowance, setSendAllowance] = useState(false);\n    const [sendAddress, setSendAddress] = useState('');\n\n    useEffect(async () => {\n        const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n        await provider.send(\"eth_requestAccounts\", []);\n        const signer = provider.getSigner();\n        const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n        const filter = erc20.filters.Transfer(signer.address);\n        erc20.on(filter, async (from, to, amount, event) => {\n            props.setTokenData({...props.tokenData, balance: await erc20.balanceOf(props.tokenData.accountAddress)});\n        });\n        return (()=>{\n            erc20.removeAllListeners();\n        });\n    }, []);\n\n    useEffect(async () => {\n        if (/^0x[a-fA-F0-9]{40}$/.test(claimOwner)) {\n            console.log(\"match\");\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const decimals = await erc20.decimals();\n            try {\n                const _allowance = await erc20.allowance(claimOwner, await signer.getAddress());\n                setAllowanceAvailable(formatBalance(_allowance.toString(), decimals));\n                setValidAllowance(true);\n            } catch(err) {\n                console.error(err);\n            }\n        }\n        else setValidAllowance(false);\n    }, [claimOwner]);\n\n    const transferTokens = async (recipient, amount) => {\n        try {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const sender = await signer.getAddress();\n            const balance = await erc20.balanceOf(sender);\n            const decimals = await erc20.decimals();\n            const success = await erc20.transfer(recipient, parseAmount(amount, decimals));\n            console.log(success);\n        } catch (e) { \n            console.error(e);\n            alert('Error: Transfer failed.');\n        }\n    }\n\n    const setTokenAllowance = async (recipient, amount) => {\n        try {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const sender = await signer.getAddress();\n            const balance = await erc20.balanceOf(sender);\n            const decimals = await erc20.decimals();\n            let success = false;\n            if (balance.gte(parseAmount(amount, decimals))) {\n                success = await erc20.approve(recipient, parseAmount(amount, decimals));\n            }\n            else alert(\"Error: Insufficient balance.\")\n            const allowance = await erc20.allowance(sender, recipient);\n        } catch (e) { \n            console.error(e);\n            alert('Error: Allowance failed.');\n        }\n    }\n\n    const transferAllowance = async (owner, recipient, amount) => {\n        try {\n            const provider = new ethers.providers.Web3Provider(window.ethereum, \"any\");\n            await provider.send(\"eth_requestAccounts\", []);\n            const signer = provider.getSigner();\n            const erc20 = new ethers.Contract(props.tokenAddress, abi, signer);\n            const spender = await signer.getAddress();\n            const balance = await erc20.balanceOf(owner);\n            const allowance = await erc20.allowance(owner, spender)\n            const decimals = await erc20.decimals();\n            let success = false;\n            if (balance >= parseAmount(amount, decimals) ) {\n                success = await erc20.transferFrom(owner, recipient, parseAmount(amount, decimals));\n            }\n            console.log(success);\n        } catch (e) { \n            console.error(e);\n            alert('Error: Transfer failed.');\n        }\n    }\n\n    const formatBalance = (balance, dec) => {\n        if (dec === 0) return balance;\n        let bal = balance;\n        while (bal.length <= dec) bal = '0'+bal;\n        bal = bal.slice(0,0-dec)+'.'+bal.slice(0-dec);\n        while (bal[bal.length-1] === '0') bal = bal.slice(0,-1);\n        if (bal[bal.length-1] === '.') bal = bal.slice(0,-1);\n        return bal;\n    }\n\n    const parseAmount = (amt, dec) => {\n        let amount = amt;\n        if (amount.indexOf('.') < 0) {\n            for (let i=0; i<dec; i++) {\n                amount=amount+'0';\n            }\n            return amount;\n        }\n        while (amount.length-amount.indexOf('.') <= dec) amount=amount+'0';\n        if (amount.length-amount.indexOf('.') > dec+1) amount = amount.slice(0,amount.indexOf('.')+dec);\n        return amount.slice(0,amount.indexOf('.'))+amount.slice(amount.indexOf('.')+1);\n    }\n\n    return (\n        <Form>\n            <h3>Token Info</h3>\n            <div className=\"form-row\"><label>Token Address: {props.tokenAddress}</label></div>\n            <div className=\"form-row\"><label>Token Name: {props.tokenData.name}</label></div>\n            <div className=\"form-row\"><label>Token Symbol: {props.tokenData.symbol}</label></div>\n            <div className=\"form-row\"><label>Account Address: {props.tokenData.accountAddress}</label></div>\n            <div className=\"form-row\"><label>Token Balance: {formatBalance(props.tokenData.balance.toString(), props.tokenData.decimals)} {props.tokenData.symbol}</label></div>\n            <h3>Transfer Tokens</h3>\n            <div className=\"form-row\">\n                <label>Recipient</label>\n                <input className=\"text-input\" value={transferRecipient} onChange={(event)=>setTransferRecipient(event.target.value)}/><br/>\n                <label>Amount</label>\n                <input type=\"number\" value={transferAmount} onChange={(event)=>setTransferAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => transferTokens(transferRecipient, transferAmount)}>Transfer</Button>\n            </div>\n            <h3>Set Token Allowance</h3>\n            <div className=\"form-row\">\n                <label>Spender</label>\n                <input className=\"text-input\" value={allowanceSpender} onChange={(event)=>setAllowanceSpender(event.target.value)}/><br/>\n                <label>Amount</label>\n                <input type=\"number\" value={allowanceAmount} onChange={(event)=>setAllowanceAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => setTokenAllowance(allowanceSpender, allowanceAmount)}>Set Allowance</Button>\n            </div>\n            <h3>Claim Allowance</h3>\n            <div className=\"form-row\">\n                <label>Owner</label>\n                <input className=\"text-input\" value={claimOwner} onChange={(event)=>setClaimOwner(event.target.value)}/><br/>\n                {validAllowance && <><label>Available Allowance: {allowanceAvailable.toString()}</label><br/></>}\n                <label>Amount</label>\n                <input type=\"number\" value={claimAmount} onChange={(event)=>setClaimAmount(event.target.value)}/>\n                <Button size=\"sm\" variant=\"danger\" onClick={() => transferAllowance(claimOwner, (sendAllowance ? sendAddress : props.tokenData.accountAddress), claimAmount)}>{sendAllowance ? \"Send Allowance\" : \"Claim Allowance\"}</Button>\n                <label><input type=\"checkbox\" checked={sendAllowance} onChange={()=>setSendAllowance(!sendAllowance)}/> Send to another address</label>\n                {sendAllowance &&\n                    <div>\n                        <label>Destination address</label>\n                        <input className=\"text-input\" value={sendAddress} onChange={(event)=>setSendAddress(event.target.value)}/>\n                    </div>}\n            </div>\n            <div className=\"form-row btn-row\">\n                <Link to=\"/token-builder/dashboard\">\n                    <Button variant=\"secondary\" onClick={props.reset}>Use a Different Token</Button>\n                </Link>\n            </div>\n        </Form>\n    )\n}\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}